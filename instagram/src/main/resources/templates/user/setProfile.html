<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>프로필 설정</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <style>
    body {
        background-color: #f5f6f8;
        font-family: "Noto Sans KR", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
    }

    .profile-box {
        background-color: #ffffff;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        width: 100%;
        max-width: 500px;
    }

    .profile-box h1, .profile-box h3 {
        text-align: center;
        color: #333;
    }

    .profile-box h1 {
        font-size: 28px;
        margin-bottom: 10px;
    }

    .profile-box h3 {
        font-size: 22px;
        margin-bottom: 30px;
    }

    .profile-box .form-control {
        margin-bottom: 15px;
        height: 45px;
        font-size: 15px;
    }

    .gender-btn-group {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 20px;
    }

    .gender-btn-group .btn {
        width: 100px;
        font-weight: bold;
        transition: 0.2s ease;
    }

    .gender-btn-group .btn:hover {
        transform: scale(1.05);
    }

    #profileSaveBtn {
        width: 100%;
        font-weight: bold;
        transition: 0.2s ease;
    }

    #profileSaveBtn:hover {
        transform: scale(1.03);
    }

    .birth-date-group {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 20px;
    }

    .birth-date-group .form-control {
        flex: 1;
    }
  </style>
</head>
<body>

<div class="profile-box">
  <h1>프로필 설정</h1>
  <h3 th:text="${user.id} + '님의 페이지'"></h3>

  <input type="text" class="form-control" placeholder="Display Name" id="display_name">
  <input type="text" class="form-control" placeholder="Bio" id="bio">

  <div class="gender-btn-group">
    <button type="button" class="btn btn-outline-primary" id="maleBtn">Male</button>
    <button type="button" class="btn btn-outline-danger" id="femaleBtn">Female</button>
  </div>

  <div class="birth-date-group">
    <input type="text" class="form-control" placeholder="Year" id="birthYear">
    <input type="text" class="form-control" placeholder="Month" id="birthMonth">
    <input type="text" class="form-control" placeholder="Date" id="birthDate">
  </div>

  <button type="button" class="btn btn-success" id="profileSaveBtn">개인 정보 등록</button>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>
  $(document).ready(function(){

    let selectedGender = null;

    $("#maleBtn").on("click", function () {
        selectedGender = "male";
        $("#maleBtn").removeClass("btn-outline-primary").addClass("btn-primary");
        $("#femaleBtn").removeClass("btn-primary btn-danger").addClass("btn-outline-danger");
    });

    $("#femaleBtn").on("click", function () {
        selectedGender = "female";
        $("#femaleBtn").removeClass("btn-outline-danger").addClass("btn-primary");
        $("#maleBtn").removeClass("btn-primary btn-outline-primary").addClass("btn-outline-primary");
    });

    $("#profileSaveBtn").on("click", function(){

      let displayName = $("#display_name").val();
      let bio = $("#bio").val();

      let birthYear = $("#birthYear").val();
      let birthMonth = $("#birthMonth").val().padStart(2, '0');
      let birthDate = $("#birthDate").val().padStart(2, '0');

      let birth = `${birthYear}-${birthMonth}-${birthDate}`;

      $.ajax({
        type: "post",
        url: "/user/profile",
        data: {
          displayName: displayName,
          bio: bio,
          gender: selectedGender,
          birthDate: birth
        },
        success: function(data){
          if(data.result == "success"){
            alert("프로필 저장 완료");
            location.href="/main";
          } else {
            alert("프로필 저장 실패");
          }
        },
        error: function(){
          alert("프로필 저장 에러");
        }
      });

    });

  });
</script>

</body>
</html>
