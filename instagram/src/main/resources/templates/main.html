<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Main</title>
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>

<div th:replace="~{ include/nav.html :: navbar}"></div>

<div class="d-flex">
    <input type="text" class="form-control w-25" placeholder="search" id="userId">
    <button type="button" class="btn btn-success" id="searchBtn">search</button>
</div>


<div th:each="post: ${postDetail}" class="postBox mt-5">
    <p th:text="'ì‘ì„±ì : ' + ${post.userId}"></p>
    <p th:text="'ì œëª© : ' + ${post.title}"></p>
    <p th:text="'ë‚´ìš© : ' + ${post.textContent}"></p>
    <p th:text="'ì‘ì„±ì¼ : ' + ${post.createdAt}"></p>
    <p th:text="'ìˆ˜ì •ì¼ : ' + ${post.updatedAt}" class="d-none"></p>

    <p th:text="'ì¢‹ì•„ìš” ê°œìˆ˜ : ' + ${post.likeCount}"></p>
    <p th:text="'ì‹«ì–´ìš” ê°œìˆ˜ : ' + ${post.dislikeCount}"></p>

    <div th:if="${!post.isLike and !post.isDislike}">
        <button type="button" class="likeBtn btn btn-outline-success" th:data-post-id="${post.postId}">ğŸ‘</button>
        <button type="button" class="dislikeBtn btn btn-outline-danger" th:data-post-id="${post.postId}">ğŸ‘</button>
    </div>
    <div th:if="${post.isLike}">
        <button type="button" class="likeCancelBtn btn btn-success" th:data-post-id="${post.postId}">ğŸ‘</button>
        <button type="button" class="dislikeBtn btn btn-outline-danger" th:data-post-id="${post.postId}">ğŸ‘</button>
    </div>
    <div th:if="${post.isDislike}">
        <button type="button" class="likeBtn btn btn-outline-success" th:data-post-id="${post.postId}">ğŸ‘</button>
        <button type="button" class="dislikeCancelBtn btn btn-danger" th:data-post-id="${post.postId}">ğŸ‘</button>
    </div>

    <button type="button" class="deleteBtn" th:data-post-id="${post.postId}">
        ê²Œì‹œê¸€ ì‚­ì œ
    </button>
</div>





<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<script>
    $(document).ready(function(){

        $(".likeCancelBtn").on("click", function(){
            let postId = $(this).data("post-id");
            $.ajax({
                type:"delete"
                , url:"/post/like"
                , data:{"postId":postId}
                , success:function(data){
                    if(data.result == "success"){
                        location.reload();
                    } else {
                        alert("ì¢‹ì•„ìš” ì·¨ì†Œ ì‹¤íŒ¨");
                    }
                }
                , error:function(){
                    alert("ì¢‹ì•„ìš” ì·¨ì†Œ ì—ëŸ¬");
                }
            });
        });

        $(".dislikeCancelBtn").on("click", function(){
            let postId = $(this).data("post-id");
            $.ajax({
                type:"delete"
                , url:"/post/like"
                , data:{"postId":postId}
                , success:function(data){
                    if(data.result == "success"){
                        location.reload();
                    } else {
                        alert("ì‹«ì–´ìš” ì·¨ì†Œ ì‹¤íŒ¨");
                    }
                }
                , error:function(){
                    alert("ì‹«ì–´ìš” ì·¨ì†Œ ì—ëŸ¬");
                }
            });
        });

        $(".deleteBtn").on("click", function(){
            let postId = $(this).data("post-id");

            $.ajax({
                type:"delete"
                , url:"/post"
                , data:{"postId":postId}
                , success:function(data){
                    if(data.result == "success"){
                        alert("ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                        location.reload();
                    } else {
                        alert("ì‚­ì œ ì‹¤íŒ¨");
                    }
                }
                , error:function(){
                    alert("ì‚­ì œ ì—ëŸ¬");
                }
            });

        });

        $(".likeBtn").on("click", function(){
            let postId = $(this).data("post-id");
            let isLike = 1;
            $.ajax({
                type:"POST"
                , url:"/post/like"
                , data:{"postId":postId, "isLike":isLike}
                , success:function(data){
                    if(data.result == "success"){
                        location.reload();
                    } else {
                        alert("ì¢‹ì•„ìš” ì‹¤íŒ¨");
                    }
                }
                , error:function(){
                    alert("ì¢‹ì•„ìš” ì—ëŸ¬");
                }

            });
        });

        $(".dislikeBtn").on("click", function(){
            let postId = $(this).data("post-id");
            let isLike = 0;

            $.ajax({
                type:"POST"
                , url:"/post/like"
                , data:{"postId":postId, "isLike":isLike}
                , success:function(data){
                    if(data.result == "success"){
                        location.reload();
                    } else {
                        alert("ì‹«ì–´ìš” ì‹¤íŒ¨");
                    }
                }
                , error:function(){
                    alert("ì‹«ì–´ìš” ì—ëŸ¬");
                }
            });
        });

        $("#searchBtn").on("click",function(){
            let userId = $("#userId").val();
            window.location.href = "/post/user?userId=" + userId;
        });
    });



</script>

</body>
</html>