<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PostDetail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="/css/style.css" type="text/css">

    <style>
        /* í™”ì‚´í‘œ ìƒ‰ ë³€ê²½ */
        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            filter: invert(70%) sepia(50%) saturate(400%) hue-rotate(170deg) brightness(95%) contrast(90%);
        }
    </style>
</head>
<body>

<div th:each="post: ${postDetail}" class="postDetailBox">

    <h3 class="mb-4">ê²Œì‹œê¸€ ìƒì„¸</h3>

    <!-- ì´ë¯¸ì§€ ìºëŸ¬ì…€ -->
    <div id="postCarousel" class="carousel slide mb-3" data-bs-ride="false">

        <!-- ğŸ”» ì‘ì€ ì  indicators -->
        <div class="carousel-indicators">
            <th:block th:each="img, iterStat : ${images}">
                <button type="button"
                        data-bs-target="#postCarousel"
                        th:data-bs-slide-to="${iterStat.index}"
                        th:classappend="${iterStat.index == 0} ? 'active'"></button>
            </th:block>
        </div>

        <div class="carousel-inner">
            <div th:each="img, iterStat : ${images}"
                 th:classappend="${iterStat.index == 0} ? ' active' : ''"
                 class="carousel-item">
                <img th:src="@{'/images/' + ${img}}" class="d-block w-100" style="max-height: 500px; object-fit: contain;">
            </div>
        </div>

        <!-- ì¢Œìš° ë²„íŠ¼ -->
        <button class="carousel-control-prev" type="button" data-bs-target="#postCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#postCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <p th:text="'ì‘ì„±ì : ' + ${postDetail.userId}"></p>
    <p th:text="'ì œëª© : ' + ${postDetail.title}"></p>
    <p th:text="'ë‚´ìš© : ' + ${postDetail.textContent}"></p>
    <p th:text="'ì‘ì„±ì¼ : ' + ${postDetail.createdAt}"></p>
    <p th:text="'ìˆ˜ì •ì¼ : ' + ${postDetail.updatedAt}"></p>

    <div th:each="tag : ${postDetail.hashtags}">
        <a th:text="'#' + ${tag}" th:href="@{'/post/tag?name=' + ${tag}}"></a>
    </div>

    <!-- ì¢‹ì•„ìš” / ì‹«ì–´ìš” ë²„íŠ¼ ì˜ì—­ -->
    <div class="reaction-area">
        <div th:if="${!post.isLike and !post.isDislike}" class="d-flex gap-2 mt-3">
            <button type="button" class="likeBtn btn btn-outline-success d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.likeCount}">0</span>
            </button>

            <button type="button" class="dislikeBtn btn btn-outline-danger d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.dislikeCount}">0</span>
            </button>
        </div>

        <div th:if="${post.isLike}" class="d-flex gap-2 mt-3">
            <button type="button" class="likeCancelBtn btn btn-success d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.likeCount}">0</span>
            </button>

            <button type="button" class="dislikeBtn btn btn-outline-danger d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.dislikeCount}">0</span>
            </button>
        </div>

        <div th:if="${post.isDislike}" class="d-flex gap-2 mt-3">
            <button type="button" class="likeBtn btn btn-outline-success d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.likeCount}">0</span>
            </button>

            <button type="button" class="dislikeCancelBtn btn btn-danger d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.dislikeCount}">0</span>
            </button>
        </div>

    </div>

    <div th:if="${postDetail.userId} == ${userId}">
        <div class="bottom-right">
            <button type="button" class="modifyBtn btn btn-sm btn-outline-warning" th:data-post-id="${post.postId}">
                ìˆ˜ì •
            </button>
            <button type="button" class="deleteBtn btn btn-sm btn-outline-danger" th:data-post-id="${post.postId}">
                ì‚­ì œ
            </button>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    $(document).ready(function(){

        $(".likeCancelBtn").on("click", function(){
            let postId = $(this).data("post-id");
            $.ajax({
                type:"delete",
                url:"/post/like",
                data:{postId:postId},
                success:function(data){
                    if(data.result === "success"){ location.reload(); }
                    else { alert("ì¢‹ì•„ìš” ì·¨ì†Œ ì‹¤íŒ¨"); }
                },
                error:function(){ alert("ì¢‹ì•„ìš” ì·¨ì†Œ ì—ëŸ¬"); }
            });
        });

        $(".dislikeCancelBtn").on("click", function(){
            let postId = $(this).data("post-id");
            $.ajax({
                type:"delete",
                url:"/post/like",
                data:{postId:postId},
                success:function(data){
                    if(data.result === "success"){ location.reload(); }
                    else { alert("ì‹«ì–´ìš” ì·¨ì†Œ ì‹¤íŒ¨"); }
                },
                error:function(){ alert("ì‹«ì–´ìš” ì·¨ì†Œ ì—ëŸ¬"); }
            });
        });

        $(".deleteBtn").on("click", function(){
            let postId = $(this).data("post-id");
            $.ajax({
                type:"delete",
                url:"/post",
                data:{postId:postId},
                success:function(data){
                    if(data.result === "success"){
                        alert("ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                        location.href="/main";
                    } else { alert("ì‚­ì œ ì‹¤íŒ¨"); }
                },
                error:function(){ alert("ì‚­ì œ ì—ëŸ¬"); }
            });
        });

        $(".likeBtn").on("click", function(){
            let postId = $(this).data("post-id");
            $.ajax({
                type:"POST",
                url:"/post/like",
                data:{postId:postId, isLike:1},
                success:function(data){
                    if(data.result === "success"){ location.reload(); }
                    else { alert("ì¢‹ì•„ìš” ì‹¤íŒ¨"); }
                },
                error:function(){ alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤"); }
            });
        });

        $(".dislikeBtn").on("click", function(){
            let postId = $(this).data("post-id");
            $.ajax({
                type:"POST",
                url:"/post/like",
                data:{postId:postId, isLike:0},
                success:function(data){
                    if(data.result === "success"){ location.reload(); }
                    else { alert("ì‹«ì–´ìš” ì‹¤íŒ¨"); }
                },
                error:function(){ alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤"); }
            });
        });
    });
</script>
</body>
</html>
