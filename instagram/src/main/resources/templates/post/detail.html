<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PostDetail</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>

<div th:each="post: ${postDetail}" class="postDetailBox">

    <h3 class="mb-4">ê²Œì‹œê¸€ ìƒì„¸</h3>

    <p th:text="'ì‘ì„±ì : ' + ${post.userId}"></p>
    <p th:text="'ì œëª© : ' + ${post.title}"></p>
    <p th:text="'ë‚´ìš© : ' + ${post.textContent}"></p>
    <p th:text="'ì‘ì„±ì¼ : ' + ${post.createdAt}"></p>
    <p th:text="'ìˆ˜ì •ì¼ : ' + ${post.updatedAt}"></p>



    <!-- ì¢‹ì•„ìš” / ì‹«ì–´ìš” ë²„íŠ¼ ì˜ì—­ -->
    <div class="reaction-area">
        <div th:if="${!post.isLike and !post.isDislike}" class="d-flex gap-2 mt-3">
            <button type="button" class="likeBtn btn btn-outline-success d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.likeCount}">0</span>
            </button>

            <button type="button" class="dislikeBtn btn btn-outline-danger d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.dislikeCount}">0</span>
            </button>
        </div>


        <div th:if="${post.isLike}" class="d-flex gap-2 mt-3">
            <button type="button" class="likeCancelBtn btn btn-success d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.likeCount}">0</span>
            </button>

            <button type="button" class="dislikeBtn btn btn-outline-danger d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.dislikeCount}">0</span>
            </button>
        </div>

        <div th:if="${post.isDislike}" class="d-flex gap-2 mt-3">
            <button type="button" class="likeBtn btn btn-outline-success d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.likeCount}">0</span>
            </button>

            <button type="button" class="dislikeCancelBtn btn btn-danger d-flex align-items-center gap-2"
                    th:data-post-id="${post.postId}">
                ğŸ‘
                <span th:text="${post.dislikeCount}">0</span>
            </button>
        </div>

    </div>
    <div class="d-flex justify-content-end mt-4">
        <button type="button" class="deleteBtn btn btn-warning"
                th:data-post-id="${post.postId}">
            ê²Œì‹œê¸€ ì‚­ì œ
        </button>
    </div>
</div>




<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function(){

            $('#newTextContent').on('input', function(){
                this.style.height = 'auto'; // ê¸°ì¡´ ë†’ì´ ì´ˆê¸°í™”
                this.style.height = (this.scrollHeight) + 'px'; // ë‚´ìš©ì— ë§ì¶° ë†’ì´ ì¡°ì ˆ
            });


            $(".likeCancelBtn").on("click", function(){
                let postId = $(this).data("post-id");
                $.ajax({
                    type:"delete"
                    , url:"/post/like"
                    , data:{"postId":postId}
                    , success:function(data){
                        if(data.result == "success"){
                            location.reload();
                        } else {
                            alert("ì¢‹ì•„ìš” ì·¨ì†Œ ì‹¤íŒ¨");
                        }
                    }
                    , error:function(){
                        alert("ì¢‹ì•„ìš” ì·¨ì†Œ ì—ëŸ¬");
                    }
                });
            });

            $(".dislikeCancelBtn").on("click", function(){
                let postId = $(this).data("post-id");
                $.ajax({
                    type:"delete"
                    , url:"/post/like"
                    , data:{"postId":postId}
                    , success:function(data){
                        if(data.result == "success"){
                            location.reload();
                        } else {
                            alert("ì‹«ì–´ìš” ì·¨ì†Œ ì‹¤íŒ¨");
                        }
                    }
                    , error:function(){
                        alert("ì‹«ì–´ìš” ì·¨ì†Œ ì—ëŸ¬");
                    }
                });
            });

            $(".deleteBtn").on("click", function(){
                let postId = $(this).data("post-id");

                $.ajax({
                    type:"delete"
                    , url:"/post"
                    , data:{"postId":postId}
                    , success:function(data){
                        if(data.result == "success"){
                            alert("ê²Œì‹œë¬¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                            location.reload();
                        } else {
                            alert("ì‚­ì œ ì‹¤íŒ¨");
                        }
                    }
                    , error:function(){
                        alert("ì‚­ì œ ì—ëŸ¬");
                    }
                });

            });

            $(".likeBtn").on("click", function(){
                let postId = $(this).data("post-id");
                let isLike = 1;
                $.ajax({
                    type:"POST"
                    , url:"/post/like"
                    , data:{"postId":postId, "isLike":isLike}
                    , success:function(data){
                        if(data.result == "success"){
                            location.reload();
                        } else {
                            alert("ì¢‹ì•„ìš” ì‹¤íŒ¨");
                        }
                    }
                    , error:function(){
                        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤");
                    }

                });
            });

            $(".dislikeBtn").on("click", function(){
                let postId = $(this).data("post-id");
                let isLike = 0;

                $.ajax({
                    type:"POST"
                    , url:"/post/like"
                    , data:{"postId":postId, "isLike":isLike}
                    , success:function(data){
                        if(data.result == "success"){
                            location.reload();
                        } else {
                            alert("ì‹«ì–´ìš” ì‹¤íŒ¨");
                        }
                    }
                    , error:function(){
                        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤");
                    }
                });
            });


        });



    </script>
</body>
</html>